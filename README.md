# OV7670-Based CCTV Motion Detection System

Real-Time Motion Detection CCTV implemented on BASYS-3 FPGA using the OV7670 camera module.

##Overview

This project implements a sophisticated real-time motion detection CCTV system using the OV7670 camera module and the BASYS-3 FPGA board. The system captures QVGA (320x240) frames in RGB555 format, processes them through grayscale conversion, Sobel edge detection, and frame differencing, and displays the results on a VGA monitor (640x480 @ 60Hz) with motion indication via LEDs. The design leverages multiple clock domains (12 MHz for OV7670, 25 MHz for VGA, and 100 MHz for internal processing) to ensure efficient operation.

The project was developed using Vivado 2020.2 and targets the BASYS-3 FPGA board.

##Features

Image Capture: Captures QVGA (320x240) frames from the OV7670 camera in RGB555 format.

Image Processing:

Converts RGB to 4-bit grayscale.

Applies 5x5 Sobel edge detection for edge enhancement.

Detects motion by comparing three consecutive frames.

VGA Display: Outputs processed frames to a 640x480 VGA display with a split-screen layout:

Left-top: Real-time upscaled camera feed.

Right-top: Motion difference map.

Motion Detection:

Adjustable sensitivity via detection_threshold and threshold parameters.

Real-time motion indication using a single-bit signal and 16-bit LED output.

Clock Management: Uses multiple clock domains (12 MHz, 25 MHz, 100 MHz) generated by the Clock Wizard IP.

##Block Diagram

The system consists of the following key modules:

Clock Generation (clk_wiz_0): Generates 12 MHz (OV7670), 25 MHz (VGA), and 100 MHz (processing) clocks.

OV7670 Configuration (OV7670_SCCB): Configures the camera via the SCCB (I2C-like) protocol.

VGA Controller (vga_controller): Generates VGA timing signals and quadrant-specific pixel coordinates.

OV7670 Controller (ov7670_controller): Captures pixel data from the OV7670 camera.

Frame Buffers (frameBuffer): Stores three consecutive frames for motion detection.

Upscaling (upscale): Upscales QVGA frames to fit the VGA display.

Grayscale Conversion (rgb2gray): Converts RGB555 data to 4-bit grayscale.

Sobel Filter (sobel_filter_5x5): Applies edge detection on grayscale frames.

Difference Detection (diff_detector_pixel): Detects pixel differences between frames.

Motion Detection (motion_detector): Aggregates differences and determines motion based on a threshold.

VGA Output (RGB_out): Drives the VGA display with processed images.

##Dependencies

Hardware:

BASYS-3 FPGA Board (or compatible Xilinx FPGA).

OV7670 Camera Module (without FIFO).

VGA Monitor and cable.

Tools:

Vivado 2020.2 (or compatible version).

IP Cores:

clk_wiz_0: Clock Wizard for generating multiple clock domains.

Custom Modules:

OV7670_SCCB

vga_controller

ov7670_controller

rgb2gray

frameBuffer_4bit

sobel_filter_5x5

diff_detector_pixel

diff_pixel_counter

motion_detector

RGB_out

upscale

frame_counter

Note: These custom modules are part of the project and must be included in the Vivado project.

##Getting Started

Prerequisites

Install Vivado 2020.2 from the Xilinx website.

Obtain a BASYS-3 FPGA board and an OV7670 camera module.

Connect the OV7670 camera to the BASYS-3 via PMOD or custom wiring (refer to pin assignments below).

Pin Assignments (BASYS-3 Constraints)

Create a .xdc constraints file with the following pin mappings (example, adjust as needed):

- Clock input (100 MHz onboard clock)
set_property -dict { PACKAGE_PIN W5  IOSTANDARD LVCMOS33 } [get_ports clk]

- Reset button
set_property -dict { PACKAGE_PIN U18 IOSTANDARD LVCMOS33 } [get_ports reset]

- OV7670 Camera Pins
set_property -dict { PACKAGE_PIN J1  IOSTANDARD LVCMOS33 } [get_ports xclk]
set_property -dict { PACKAGE_PIN G2  IOSTANDARD LVCMOS33 } [get_ports pclk]
set_property -dict { PACKAGE_PIN H1  IOSTANDARD LVCMOS33 } [get_ports href]
set_property -dict { PACKAGE_PIN K2  IOSTANDARD LVCMOS33 } [get_ports vref]
set_property -dict { PACKAGE_PIN L2  IOSTANDARD LVCMOS33 } [get_ports {ov7670_data[7]}]
... (add remaining ov7670_data[6:0], sda, scl pins)

- VGA Pins
set_property -dict { PACKAGE_PIN G19 IOSTANDARD LVCMOS33 } [get_ports {red_port[3]}]
... (add remaining red_port, green_port, blue_port, h_sync, v_sync pins)

- LEDs for Motion Detection
set_property -dict { PACKAGE_PIN U16 IOSTANDARD LVCMOS33 } [get_ports {motion_detected_led[0]}]
... (add remaining motion_detected_led[15:1] pins)

##Installation

git clone https://github.com/yourusername/ov7670-cctv-motion-detection.git
cd ov7670-cctv-motion-detection

Open Vivado 2020.2 and create a new project targeting the BASYS-3 board.

Add all .v files from the repository to the project.

Add the .xdc constraints file.

Generate the bitstream and program the FPGA.

##Usage

Power on the BASYS-3 board and connect it to a VGA monitor.

Ensure the OV7670 camera is properly connected and powered.

The system will:

Display the real-time camera feed on the left-top quadrant.

Show the motion difference map on the right-top quadrant.

Illuminate LEDs when motion is detected (based on detection_threshold).

Adjust detection_threshold and threshold parameters in the top module to tune motion sensitivity.

##Project Details

Created Date: March 20, 2025

Engineer: T.Y Jang

Target Device: BASYS-3

Tool Version: Vivado 2020.2

Revision: 0.01

License

This project is licensed under the MIT License - see the LICENSE file for details.

Acknowledgments

Inspired by real-time image processing techniques and FPGA-based systems.

Thanks to the open-source hardware community for OV7670 and VGA resources.

